<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Using Coereba • Coereba</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using Coereba">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Coereba</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.99.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Workflow.html">Using Coereba</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/DavidRach/Coereba/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Using Coereba</h1>
                        <h4 data-toc-skip class="author">David Rach</h4>
            <address class="author_afil">
      University of Maryland,
Baltimore<br><a class="author_email" href="mailto:#"></a><a href="mailto:drach@som.umaryland.edu" class="email">drach@som.umaryland.edu</a>
      </address>
                  
            <h4 data-toc-skip class="date">1 June 2025</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/DavidRach/Coereba/blob/HEAD/vignettes/Workflow.Rmd" class="external-link"><code>vignettes/Workflow.Rmd</code></a></small>
      <div class="d-none name"><code>Workflow.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>Manual (supervised) analysis is widespread in cytometry (especially
conventional flow cytometry (CFC)), wherein researchers will draw
hierarchial boolean gates around cell populations using the graphical
user interface provided by various commercial softwares. By sequentially
switching between markers, you end up filtering down to smaller subsets
of cells of potential interest.</p>
<p>With the increase in markers (initially by mass cytometry (MC),
recently by spectral flow cytometry (SFC)) and accompanying
combinatorial combinations needing to be gated, algorithmic
(unsupervised) analysis methods have been developed to cluster cells on
basis median fluorescent intensity (MFI) of individual markers.</p>
<p>While these handle more combinatorial data, how many identified
clusters are present (and/or biologically meaningful) remains a point of
concern. The additional dependence on MFI values being consistent across
individuals and experiments increases these methods susceptibility to
batch effects.</p>
</div>
<div class="section level2">
<h2 id="rationale">Rationale<a class="anchor" aria-label="anchor" href="#rationale"></a>
</h2>
<p>SFC datasets in particular, collecting greater numbers of cells than
MC and increased number of markers compared to CFC, require new tools to
enable comprehensive profiling of phenotypes present within the acquired
cells. These datasets loss resolution due to improper unmixing controls
poses additional challenges.</p>
<p>Coereba is a collection of tools that attempt to implement a
semi-supervised analytical approach. Using automated gating, splitpoints
between positive and negative cells for every marker are estimated on an
individual basis. Through extensive visualization and a ShinyApp,
failures in gate setting by algorithmic gating can be adjusted by the
researcher. Individual cells are then classified on the basis of these
marker splitpoints, and the identity and metadata information is
appended to the .fcs file.</p>
<p>Following unsupervised analysis, this manually defined gating
information can extracted and used both for analysis and verify the
algorithm performed as predicted across specimens. Due to the researcher
intervention, it is more resilient to batch effects than a pure MFI
approach.</p>
<p>The author and maintainer in no part claims that Coereba is the
solution to all cytometry analysis woes. It is a tool in the open-source
toolbelt that can enable you to do useful things and figure out
interesting quirks that you wouldn’t be otherwise able to do. Go forth,
gain better understanding underlying problems our current paradigms
have, and may the next generation of researchers benefit from what we
learn.</p>
</div>
<div class="section level2">
<h2 id="getting-started">Getting Started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<div class="section level3">
<h3 id="installing-coereba">Installing Coereba<a class="anchor" aria-label="anchor" href="#installing-coereba"></a>
</h3>
<p>The Coereba R package is in preparation for submission to
Bioconductor later this year. Until that time, it is available for
install via GitHub.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://remotes.r-lib.org" class="external-link">"remotes"</a></span><span class="op">)</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span><span class="op">}</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"https://github.com/DavidRach/Coereba"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># install.packages("BiocManager")</span></span>
<span><span class="co"># BiocManager::install("Coereba")</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="loading-libraries">Loading Libraries<a class="anchor" aria-label="anchor" href="#loading-libraries"></a>
</h3>
<p>Coereba relies on underlying infrastructure provided <em><a href="https://bioconductor.org/packages/3.21/flowWorkspace" class="external-link">flowWorkspace</a></em>
and other Bioconductor cytometry packages. It leverages functional
programming principles implemented in <em><a href="https://CRAN.R-project.org/package=tidyverse" class="external-link">tidyverse</a></em>
packages available via CRAN. It is important to make sure that all the
required packages are installed on your computer, and that library is
called for each.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DavidRach/Coereba" class="external-link">Coereba</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">flowCore</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">flowWorkspace</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">openCyto</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RGLab/ggcyto/issues" class="external-link">ggcyto</a></span><span class="op">)</span>  </span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span> </span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gt.rstudio.com" class="external-link">gt</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://plotly-r.com" class="external-link">plotly</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/htmltools" class="external-link">htmltools</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="locating--fcs-files">Locating .fcs files<a class="anchor" aria-label="anchor" href="#locating--fcs-files"></a>
</h4>
<p>To get started, you will first need to provide the location on your
computer where the .fcs files of interest are being stored. An example
of how the author does this is provided below and can be modified for
your own user and desired computer folder.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">File_Location</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"C:"</span>, <span class="st">"Users"</span>, <span class="st">"JohnDoe"</span>, <span class="st">"Desktop"</span>, <span class="st">"TodaysExperiment"</span><span class="op">)</span></span>
<span><span class="va">FCS_Pattern</span> <span class="op">&lt;-</span> <span class="st">".fcs$"</span></span>
<span><span class="va">FCS_Files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">File_Location</span>, pattern <span class="op">=</span> <span class="va">FCS_Pattern</span>,</span>
<span>                        full.names <span class="op">=</span> <span class="cn">TRUE</span>, recursive <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>For this vignette, we will using several small .fcs files that can be
found in Coereba’s extdata folder for our example.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">File_Location</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"Coereba"</span><span class="op">)</span></span>
<span><span class="va">FCS_Pattern</span> <span class="op">&lt;-</span> <span class="st">".fcs$"</span></span>
<span><span class="va">FCS_Files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">File_Location</span>, pattern <span class="op">=</span> <span class="va">FCS_Pattern</span>,</span>
<span>                        full.names <span class="op">=</span> <span class="cn">TRUE</span>, recursive <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">FCS_Files</span>, <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p>The folder contains three unmixed full-stained samples from a
29-color SFC panel, characterizing Innate-like T cells (ILT) in cord
blood mononuclear cells (CBMCs). As rare circulating cells, the original
.fcs files contained many cellular events, which makes them useful to
show off Coereba’s capabilities at characterizing cells that were not
the original focus.</p>
</div>
<div class="section level4">
<h4 id="creating-a-gatingset-for-unmixed--fcs-files">Creating a GatingSet for Unmixed .fcs files<a class="anchor" aria-label="anchor" href="#creating-a-gatingset-for-unmixed--fcs-files"></a>
</h4>
<p>Working with the unmixed full-stained samples mentioned above, we
will proceed by bringing the .fcs files found within Coereba’s extdata
folder into a GatingSet object where we can interact with them.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">UnmixedFCSFiles</span> <span class="op">&lt;-</span> <span class="va">FCS_Files</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">UnmixedCytoSet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowWorkspace/man/load_cytoset_from_fcs.html" class="external-link">load_cytoset_from_fcs</a></span><span class="op">(</span><span class="va">UnmixedFCSFiles</span>, truncate_max_range <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                        transformation <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">UnmixedGatingSet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowWorkspace/man/GatingSet-class.html" class="external-link">GatingSet</a></span><span class="op">(</span><span class="va">UnmixedCytoSet</span><span class="op">)</span></span>
<span><span class="va">UnmixedGatingSet</span></span></code></pre></div>
<p>Now that we have created a GatingSet object, we will identify the
markers/fluorophores present within the .fcs files, and exclude markers
from the list don’t require transformation (as is the case with FSC,
SSC). We will then bi-exponentially transform the data using <em><a href="https://bioconductor.org/packages/3.21/flowWorkspace" class="external-link">flowWorkspace</a></em>
<code><a href="https://rdrr.io/pkg/flowWorkspace/man/flowjo_biexp_trans.html" class="external-link">flowWorkspace::flowjo_biexp_trans()</a></code> before applying a
<em><a href="https://bioconductor.org/packages/3.21/openCyto" class="external-link">openCyto</a></em>gating
template that was customized for this particular panel, which can be
found in the extdata folder.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Markers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">UnmixedCytoSet</span><span class="op">)</span></span>
<span><span class="va">KeptMarkers</span> <span class="op">&lt;-</span> <span class="va">Markers</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"Time|FS|SC|SS|Original|-W$|-H$|AF"</span>, <span class="va">Markers</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">MyBiexponentialTransform</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowWorkspace/man/flowjo_biexp_trans.html" class="external-link">flowjo_biexp_trans</a></span><span class="op">(</span>channelRange <span class="op">=</span> <span class="fl">256</span>, maxValue <span class="op">=</span> <span class="fl">1000000</span>,</span>
<span>                                               pos <span class="op">=</span> <span class="fl">4.5</span>, neg <span class="op">=</span> <span class="fl">0</span>, widthBasis <span class="op">=</span> <span class="op">-</span><span class="fl">1000</span><span class="op">)</span></span>
<span><span class="va">TransformList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowWorkspace/man/transformerList.html" class="external-link">transformerList</a></span><span class="op">(</span><span class="va">KeptMarkers</span>, <span class="va">MyBiexponentialTransform</span><span class="op">)</span></span>
<span><span class="va">UnmixedGatingSet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/transform.html" class="external-link">transform</a></span><span class="op">(</span><span class="va">UnmixedGatingSet</span>, <span class="va">TransformList</span><span class="op">)</span></span>
<span></span>
<span><span class="va">UnmixedGates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">File_Location</span>, pattern <span class="op">=</span> <span class="st">'GatesUnmixed.csv'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">UnmixedGating</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/openCyto/man/gatingTemplate-class.html" class="external-link">gatingTemplate</a></span><span class="op">(</span><span class="va">UnmixedGates</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/openCyto/man/gt_gating.html" class="external-link">gt_gating</a></span><span class="op">(</span><span class="va">UnmixedGating</span>, <span class="va">UnmixedGatingSet</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">UnmixedGatingSet</span><span class="op">)</span></span></code></pre></div>
<p>We can additionally verify that the gating of the cell populations of
interest was correct, by visualizing the gates using <em><a href="https://bioconductor.org/packages/3.21/ggcyto" class="external-link">ggcyto</a></em> or
the Luciernaga package.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://davidrach.github.io/Luciernaga/" class="external-link">Luciernaga</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">MyPlot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://davidrach.github.io/Luciernaga/reference/Utility_GatingPlots.html" class="external-link">Utility_GatingPlots</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">UnmixedGatingSet</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, sample.name<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GROUPNAME"</span>, <span class="st">"TUBENAME"</span><span class="op">)</span>,</span>
<span>                              removestrings<span class="op">=</span><span class="st">".fcs"</span>, subset<span class="op">=</span><span class="st">"live"</span>, gtFile<span class="op">=</span><span class="va">UnmixedGates</span>,</span>
<span>                              DesiredGates<span class="op">=</span><span class="cn">NULL</span>, outpath <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span>, export<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>                              therows<span class="op">=</span><span class="fl">3</span>, thecolumns<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">MyPlot</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="coereba_gatecutoffs">Coereba_GateCutoffs<a class="anchor" aria-label="anchor" href="#coereba_gatecutoffs"></a>
</h2>
<p>Having set up a GatingSet with transformations and gates applied, we
can proceed to test the <code>Coereba</code> workflow. The first step is
to create a .csv file, containing the individual specimens, and the
individual markers of interest. Each cell within the .csv file will
correspond to the MFI for a given marker for a given individual where
positive expression of a marker transitions to becoming a negative
(referred here to as a splitpoint).</p>
<p>These could be written out individually, or based on automated
calculations. To simplify the process, in Coereba, we have implemented
two approaches to estimating these splitpoints. One function is the
in-house <code><a href="../reference/Coereba_GateCutoffs.html">Coereba_GateCutoffs()</a></code>, which does an “okay-ish but
work-in progress”. The flip approach is leveraging the <em><a href="https://bioconductor.org/packages/3.21/openCyto" class="external-link">openCyto</a></em>
pipeline (in development) and retrieving the values.</p>
<p>Both approaches can be computationally heavy, but still faster than
eye-balling everything and typing in the values one-by-one. Save the
eyestrain for subsequent validation steps.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TheGateCutoff</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Coereba_GateCutoffs.html">Coereba_GateCutoffs</a></span><span class="op">(</span>gs<span class="op">=</span><span class="va">UnmixedGatingSet</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>  subset<span class="op">=</span><span class="st">"live"</span>, sample.name<span class="op">=</span><span class="st">"GROUPNAME"</span>, desiredCols <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BUV805-A"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">TheGateCutoffs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span>.x<span class="op">=</span><span class="va">UnmixedGatingSet</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, .f<span class="op">=</span><span class="va">Coereba_GateCutoffs</span>,</span>
<span>  subset<span class="op">=</span><span class="st">"live"</span>, sample.name<span class="op">=</span><span class="st">"GROUPNAME"</span>, desiredCols <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BUV805-A"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TheGateCutoffs</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="visualizing-gate-cutoffs">Visualizing Gate Cutoffs<a class="anchor" aria-label="anchor" href="#visualizing-gate-cutoffs"></a>
</h2>
<p>Once we have generated a GateCutoffs.csv file, we can visualize how
well the splitpoints were by plotting them as red-lines using the
<code>Luciernaga</code> packages <code><a href="https://davidrach.github.io/Luciernaga/reference/Utility_NbyNPlots.html" class="external-link">Utility_NbyNPlots()</a></code> to
visualize the markers for a given individual and
<code>Utility_UnityPlots()</code> to visualize the markers across
individuals. This a good way of understanding how well the competing
gating-algorithms did in the context of your individual panel, and how
much effort will be required for the next step in correcting the gates
individually.</p>
</div>
<div class="section level2">
<h2 id="coereba_app">Coereba_App<a class="anchor" aria-label="anchor" href="#coereba_app"></a>
</h2>
<p>Previously, all adjustments to the above splitpoints had to
eye-balled in the pdf, and then adjusted in the .csv file, and repeated
ad nauseum. This obviously did not scale well. We have subsequently
created a ShinyApp that will bring in the GatingSet object, and plot an
interactive version of <code><a href="https://davidrach.github.io/Luciernaga/reference/Utility_UnityPlot.html" class="external-link">Utility_UnityPlot()</a></code> from the
<code>Luciernaga</code> package, visualizing the splitpoint for a given
marker across all individuals as red vertical lines.</p>
<p>To get started, first make sure you know where the
<code><a href="../reference/Coereba_GateCutoffs.html">Coereba_GateCutoffs()</a></code> .csv output is saved at, as you will
need to select the file within the App.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">File_Location</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"Coereba"</span><span class="op">)</span></span>
<span><span class="va">TheCSV</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">File_Location</span>, <span class="st">"GateCutoffsForNKs.csv"</span><span class="op">)</span></span>
<span><span class="va">TheCSVData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="va">TheCSV</span>, check.names<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">TheCSVData</span><span class="op">)</span></span></code></pre></div>
<p>Next, make sure to remember the name of your GatingSet
(“UnmixedGatingSet” for this case), and the sample.name keyword to
identify individual specimens, as you will need to input these values
within the app.</p>
<p>Then, run the following command in your console:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/Coereba_App.html">Coereba_App</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The first tab view will let you upload the GateCutoff.csv file
generated by the previous function, by letting you navigate to the
storage folder and clicking on it.</p>
<p>Once this is done, navigate to the Upload a GatingSet tab. Enter the
information about your GatingSet (“UnmixedGatingSet” for this example),
select your x and y parameters, enter the SampleName keyword. Desired
bins allows adjustments to the visualization given the number of cells
present, clearance multiplier adjust the margins wiggle-room,
removestrings arguments. You specify margin and gate subsets like you
would for <code>Utility_UnityPlots()</code> and click Display Estimated
Gate Cutoffs. Finally, you click on Generate Plots and go retrieve your
coffee/tea/beverage-of-choice.</p>
<p>Upon loading of the plots, scroll until you encounter a splitpoint
line that was placed incorrectly, you can simply click on the correct
location of the axis, which will save the coordinate as a splitpoint for
that given marker and individual to a data.frame. This will later be
ported to update the corresponding splitpoint value for a given marker
and individual in the exisiting GateCutoff .csv. By just clicking, you
can therefore quickly correct cases where the algorithm failed to gate
properly due to batch effects, bad staining, or algorithmic incompetence
(sorry, the coders are still learning as well).</p>
<p>Once you have corrected some/all the markers, navigate to the Click
Data tab. You can then export the click-data information by specifying a
filename and providing an outpath to the folder you want to save at.
Unfortunately, due to security issues in ShinyApps, you will need to
type out the designated outpath manually.</p>
<p>And repeat until the markers you are interested have been validated
and you have a folder of clickpoint .csvs awaiting conversion into the
existing GateCutoff folder.</p>
<p>Since the code is within a ShinyApp running in R, it has both the
advantages and disadvantages of a R Shiny App. It scales reasonably
well, but can take a while to load the next iterated marker. During
testing, loading a new marker to inspect took anywhere from 3-10
additional minutes. This area is a active work in progress to speed up,
but the author/maintainer hasn’t had the time to finish reading
Mastering Shiny by Hadley Wickham yet or implement it in Rust, if you
have, feel free to assist!</p>
</div>
<div class="section level2">
<h2 id="coereba_updategates">Coereba_UpdateGates<a class="anchor" aria-label="anchor" href="#coereba_updategates"></a>
</h2>
<p>Once you have completed validating the GateCutoffs with
<code><a href="../reference/Coereba_App.html">Coereba_App()</a></code>, it is time to convert your validated
click-data and update the GateCutoff.csv. To fascilitate this, provide
the location of the folder containing just the clickpoint .csv’s to
<code><a href="../reference/Coereba_UpdateGates.html">Coereba_UpdateGates()</a></code> and fill out the required arguments.
It will proceed to update the GateCutoffs.</p>
<p>For this example, we will use ClickDataExamples.csv stored within
<code>Coereba</code>’s extdata folder:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">File_Location</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"Coereba"</span><span class="op">)</span></span>
<span><span class="va">TheOldCSV</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">File_Location</span>, <span class="st">"GateCutoffsForNKs.csv"</span><span class="op">)</span></span>
<span><span class="va">TheClickInfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">File_Location</span>, <span class="st">"ClickDataExample.csv"</span><span class="op">)</span></span>
<span><span class="va">TheClickData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="va">TheClickInfo</span>, check.names<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">TheClickData</span></span></code></pre></div>
<p>The old data:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TheOldData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="va">TheOldCSV</span>, check.names<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">TheOldData</span></span></code></pre></div>
<p>We can then run <code><a href="../reference/Coereba_UpdateGates.html">Coereba_UpdateGates()</a></code> and watch the
values for BUV469-A are updated.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">UpdatedCSV</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Coereba_UpdateGates.html">Coereba_UpdateGates</a></span><span class="op">(</span>Clicks<span class="op">=</span><span class="va">TheClickInfo</span>, Old<span class="op">=</span><span class="va">TheOldCSV</span>,</span>
<span>  export<span class="op">=</span><span class="cn">FALSE</span>, outpath<span class="op">=</span><span class="cn">NULL</span>, fileName<span class="op">=</span><span class="st">"UpdatedCSV"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">UpdatedCSV</span></span></code></pre></div>
<p>We can further validate this by re-running <code>Luciernaga</code>
<code>Utility_UnityPlots()</code> using the updated GateCutoff.csv and
seeing if the previous issues have been corrected.</p>
</div>
<div class="section level2">
<h2 id="note-on-cell-populations-and-splitpoint">Note on Cell Populations and Splitpoint<a class="anchor" aria-label="anchor" href="#note-on-cell-populations-and-splitpoint"></a>
</h2>
<p>During development, we have noticed that for SFC data, the splitpoint
location can vary substantially for individual cell populations (B
cells, NK cells, T cells, etc), even in the abscence of biology. We
believe this is due to uncertainty in the unmixing, as we have observed
a correlation of negative splitpoint MFI in relation to the individual
cells kappa value (matrix complexity essentially). Try your best to have
the gate reflect what you are interested in, reduce the amount of error
as much as you can, and in numbers veritas. Keep track of the exceptions
(more later) and write up a Cyto paper.</p>
</div>
<div class="section level2">
<h2 id="how-coereba-works">How Coereba works<a class="anchor" aria-label="anchor" href="#how-coereba-works"></a>
</h2>
<p>Having a GateCutoff.csv containing the splitpoint information for
each marker validated for each individual is immensely useful, allowing
you to do many things you wouldn’t be capable of otherwise. Namely, we
can for an individual anotate each cell within their .fcs file.</p>
<p>What do I mean? Let’s first think about all the cells circulating in
an individuals bloostream. We don’t have any prior information in this
example, but we want to profile these cells into clusters of similar
cells. On one end of the spectra, there is a single cluster that
contains every single cell from the sample, regardless of their marker
expression. At the opposite end of the spectrum, every single cell
clusters in an it’s own cluster with just itself. In between these two
extremes, depending on our question, lies a meaningful cluster number
that will match the underlying biology to reduce the amount of variance
that lies in clumping/splitting populations needlessly.</p>
<p><code>Coereba</code> takes the approacch by individually annotating
an individuals cells one by one, on the basis of where their MFI value
lands related to the validated splitpoint. So if the splitpoint for FITC
is at 50, and the individual cell MFI for FITC is 80, it returns as
FITC_pos. If the splitpoint for APC is at 70, and the individual cell
MFI is 30, it returns as APC_Neg.</p>
<p>When you iterate over the splitpoints for each marker, each cell
derrives an identity. FITC_pos-APC_Neg-BV421_Pos…. etc. We can then
group cells with matching identies and derrive information from these
terminal nodes.</p>
<p>Individually, this may not mean much. After all, dichotomous
splitting of a 30-marker panel is around half-a billion potential
terminal nodes or clusters. Similarly, cytometers have instrumental,
batch, experimental noise, etc.</p>
<p>But when we scale to all the events collected within a typical
sample, we get far fewer terminal nodes, in the hundred to lower
thousand range for a 30-color panel. The reason is cells (and the panels
by which we investigate them) are not uniformely distributed by markers
across high-dimensional space, cells fall within specific phenotypes
(cell types) that undergo division of similar clones.</p>
<p>Consequently, we can iteratively leverage the number of markers
included to target questions of interest, broad or narrow scope, in
context of our individual panels, and rely on methods described below to
gain insight into biological systems.</p>
</div>
<div class="section level2">
<h2 id="utility_coereba">Utility_Coereba<a class="anchor" aria-label="anchor" href="#utility_coereba"></a>
</h2>
<p><code><a href="../reference/Utility_Coereba.html">Utility_Coereba()</a></code> is the function that implements the
above approach, labelling for each individual specimen the individual
cells on the basis of their splitpoint identity, and then returning the
enumeration of the resulting clusters. It iterates over the different
specimens in the GatingSet, returning information for every individual
that can be used in subsequent steps. <code>MultiReach()</code> is the
older version of the proccess.</p>
<p>Both functions are currently waiting on the ILT paper to be sent to
collaborators so that David can implement his 5-subject binder worth of
notes to implement a S4 OOP class to make manipulating the final outputs
easier than the current .qmd files full of tidyverse data tidying.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CoerebaIDs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Utility_Coereba.html">Utility_Coereba</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">UnmixedGatingSet</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, subsets<span class="op">=</span><span class="st">"live"</span>,</span>
<span>  sample.name<span class="op">=</span><span class="st">"GROUPNAME"</span>, reference<span class="op">=</span><span class="va">TheCSV</span>, starter<span class="op">=</span><span class="st">"Spark Blue 550-A"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">CoerebaIDs</span>, <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="filtering-coereba-clusters">Filtering Coereba Clusters<a class="anchor" aria-label="anchor" href="#filtering-coereba-clusters"></a>
</h2>
<p>Some things are literally poisson noise. Others are cell clusters
with varying abundance across heteregenous human patients. Others are
individually unique terminal nodes that can be the result of individual
biology…. or unmixing errors … or your lab tech messing up the staining
panel. You can leverage the filter functions to identify all of these
quickly.</p>
</div>
<div class="section level2">
<h2 id="coereba_markerexpressions">Coereba_MarkerExpressions<a class="anchor" aria-label="anchor" href="#coereba_markerexpressions"></a>
</h2>
<p>Having generated a Marker by Cluster data.frame (binaryData) and a
Cluster by Specimen data.frame (dataData), we can leverage the
combination of the two data.frames to aggregate the clusters on the
basis of marker presence, returning the proportion of of cells that are
positive for a given marker.</p>
<p>For this demonstration, we will focus on NKTs, using stored .csv
files for their binary and data outputs stored within the Coereba
extdata folder.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">File_Location</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"Coereba"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">panelPath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">File_Location</span>, <span class="st">"ILTPanelTetramer.csv"</span><span class="op">)</span></span>
<span><span class="va">panelData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="va">panelPath</span>, check.names<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">binaryPath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">File_Location</span>, <span class="st">"HeatmapExample.csv"</span><span class="op">)</span></span>
<span><span class="va">binaryData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="va">binaryPath</span>, check.names<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dataPath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">File_Location</span>, <span class="st">"ReadyFileExample.csv"</span><span class="op">)</span></span>
<span><span class="va">dataData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="va">dataPath</span>, check.names<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>We will first just return the marker expressions for all markers:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DavidRach/Coereba" class="external-link">Coereba</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">AllMarkers</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Coereba_MarkerExpressions.html">Coereba_MarkerExpressions</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">dataData</span>, binary<span class="op">=</span><span class="va">binaryData</span>,</span>
<span>  panel<span class="op">=</span><span class="va">panelData</span>, starter<span class="op">=</span><span class="st">"SparkBlue550"</span><span class="op">)</span></span>
<span>  </span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">AllMarkers</span>, <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<p>We can additionally by specifying returnType = “Combinatorial”
derrive proportions within quadrant gates for two markers of interest.
To do so, we specify the fluorophores corresponding to the markers as a
list in the CombinatorialArgs.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">MemoryQuadrants</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Coereba_MarkerExpressions.html">Coereba_MarkerExpressions</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">dataData</span>, binary<span class="op">=</span><span class="va">binaryData</span>,</span>
<span>  panel<span class="op">=</span><span class="va">panelData</span>, starter<span class="op">=</span><span class="st">"SparkBlue550"</span>, returnType <span class="op">=</span> <span class="st">"Combinatorial"</span>, </span>
<span>  CombinatorialArgs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BV510"</span>, <span class="st">"BUV395"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">MemoryQuadrants</span>, <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="utility_markerplots">Utility_MarkerPlots<a class="anchor" aria-label="anchor" href="#utility_markerplots"></a>
</h2>
<p>Having returned aggregated data above with
<code>Coereba_MarkerExpressions</code>, we can plot this data using
<code><a href="../reference/Utility_MarkerPlots.html">Utility_MarkerPlots()</a></code>. These are combination of <em><a href="https://CRAN.R-project.org/package=ggplot2" class="external-link">ggplot2</a></em>
geom_boxplot() and <em><a href="https://CRAN.R-project.org/package=ggbeeswarm" class="external-link">ggbeeswarm</a></em>
geom_beeswarm plots. We provide some arguments that allow for filtering
and reordering the markers shown in these plots, some basic
customizations to the plots, and the ability to save as a .png file to a
designated folder.</p>
<p>To do so for your own individual spots, you will need to specify a
metadata column by which to factor by, and provide a list of shape and
fill values corresponding to each factor level.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shape_ptype</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"HU"</span> <span class="op">=</span> <span class="fl">22</span>, <span class="st">"HEU-lo"</span> <span class="op">=</span> <span class="fl">21</span>, <span class="st">"HEU-hi"</span> <span class="op">=</span> <span class="fl">21</span><span class="op">)</span></span>
<span><span class="va">fill_ptype</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"HU"</span> <span class="op">=</span> <span class="st">"white"</span>, <span class="st">"HEU-lo"</span> <span class="op">=</span> <span class="st">"darkgray"</span>, <span class="st">"HEU-hi"</span> <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span></code></pre></div>
<p>We can start by viewing all markers:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ThePlot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Utility_MarkerPlots.html">Utility_MarkerPlots</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">AllMarkers</span>, panel<span class="op">=</span><span class="va">panelData</span>,</span>
<span>  myfactor<span class="op">=</span><span class="st">"ptype"</span>, shape_palette <span class="op">=</span> <span class="va">shape_ptype</span>, fill_palette <span class="op">=</span> <span class="va">fill_ptype</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ThePlot</span></span></code></pre></div>
<p>Let’s abbreviate the number of columns by specifying the marker names
to include (filterForThese), and rearrange them in desired X-axis
order</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ThePlot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Utility_MarkerPlots.html">Utility_MarkerPlots</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">AllMarkers</span>, panel<span class="op">=</span><span class="va">panelData</span>,</span>
<span>  myfactor<span class="op">=</span><span class="st">"ptype"</span>, shape_palette <span class="op">=</span> <span class="va">shape_ptype</span>, fill_palette <span class="op">=</span> <span class="va">fill_ptype</span>,</span>
<span>  filterForThese<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD7"</span>, <span class="st">"CD4"</span>, <span class="st">"CD8"</span><span class="op">)</span>, XAxisLevels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD7"</span>, <span class="st">"CD4"</span>, <span class="st">"CD8"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ThePlot</span></span></code></pre></div>
<p>And to ggsave directly to a desired folder:</p>
</div>
<div class="section level2">
<h2 id="utility_stats">Utility_Stats<a class="anchor" aria-label="anchor" href="#utility_stats"></a>
</h2>
<p>The <code><a href="../reference/Utility_Stats.html">Utility_Stats()</a></code> and the
<code><a href="../reference/Utility_Behemoth.html">Utility_Behemoth()</a></code> functions are either: “Great!!!”, or
guaranteed to make your friendly-local statistician cry (Opinions
vary).</p>
<p>Basically, <code><a href="../reference/Utility_Stats.html">Utility_Stats()</a></code> is a coding-attempt to
replicate the typical immunologist workflow, cutting out the need to
copy-paste data from a .csv file into GraphPad Prism (trademark), run a
normality test, determine number of groups, and follow up with the
corresponding t-test/anova/non-parametric equivalents.
<code><a href="../reference/Utility_Behemoth.html">Utility_Behemoth()</a></code> then takes these outputs, and adds the
p-value results to a ggbeeswarm/ggplot2 boxplot of the underlying data.
In combination with <em><a href="https://CRAN.R-project.org/package=purrr" class="external-link">purrr</a></em> and
<code>Luciernaga</code> <code><a href="https://davidrach.github.io/Luciernaga/reference/Utility_Patchwork.html" class="external-link">Utility_Patchwork()</a></code>, these can be
quickly formatted into a .pdf.</p>
<p>Does this workflow rapidly profile all the columns in your
data.frame. Yes it does. Is it emblematic of potential issues arising
from basing science entirely on null-hypothesis statistical testing?
Also yes, seeing how many plots return “significant” due to a couple
outliers. In the end, it mimics the current workflow of many
researchers, just speeding it up. Google Statistical Rethinking on
YouTube for food-for-thought.</p>
<p>To begin, we will use the <code>Coereba_MarkerExpressions</code> data
we generated above to test out <code><a href="../reference/Utility_Stats.html">Utility_Stats()</a></code>.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Utility_Stats.html">Utility_Stats</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">AllMarkers</span>, var<span class="op">=</span><span class="st">"CD62L"</span>,</span>
<span>  myfactor<span class="op">=</span><span class="st">"ptype"</span>, normality<span class="op">=</span><span class="st">"dagostino"</span>, correction<span class="op">=</span><span class="st">"none"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Result</span></span></code></pre></div>
<p>In combination with <em><a href="https://CRAN.R-project.org/package=purrr" class="external-link">purrr</a></em> we can
rapidly iterate over all the markers, but will need to skip over the
metadata columns that are present at the begining of the dataframe.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co"># colnames(AllMarkers)</span></span>
<span><span class="va">TheLength</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">AllMarkers</span><span class="op">)</span></span>
<span></span>
<span><span class="va">TheData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">AllMarkers</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">9</span><span class="op">:</span><span class="va">TheLength</span><span class="op">)</span><span class="op">]</span>, <span class="op">~</span> <span class="fu"><a href="../reference/Utility_Stats.html">Utility_Stats</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">AllMarkers</span>, var <span class="op">=</span> <span class="va">.x</span>, myfactor <span class="op">=</span> <span class="st">"ptype"</span>, </span>
<span>  normality <span class="op">=</span> <span class="st">"dagostino"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The results can be filtered using regular <em><a href="https://CRAN.R-project.org/package=dplyr" class="external-link">dplyr</a></em>
functions.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">MaybeSignificant</span> <span class="op">&lt;-</span> <span class="va">TheData</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">pvalue</span> <span class="op">&lt;</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span></span>
<span><span class="va">MaybeSignificant</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="utility_behemoth">Utility_Behemoth<a class="anchor" aria-label="anchor" href="#utility_behemoth"></a>
</h2>
<p><code><a href="../reference/Utility_Behemoth.html">Utility_Behemoth()</a></code> continues from where
<code><a href="../reference/Utility_Stats.html">Utility_Stats()</a></code> left-off, appending the resulting p-value
information onto a ggplot2 plot. The plot is a combination of <em><a href="https://CRAN.R-project.org/package=ggplot2" class="external-link">ggplot2</a></em>
geom_boxplot() and <em><a href="https://CRAN.R-project.org/package=ggbeeswarm" class="external-link">ggbeeswarm</a></em>
geom_beeswarm plots, and accepts arguments to customize these and
rearrange the group order. As with most <code>Coereba</code> plots, we
need to provide the shape and fill for our respective factors
levels.</p>
<p>To do so for your own individual spots, you will need to specify a
metadata column by which to factor by, and provide a list of shape and
fill values corresponding to each factor level.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shape_ptype</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"HU"</span> <span class="op">=</span> <span class="fl">22</span>, <span class="st">"HEU-lo"</span> <span class="op">=</span> <span class="fl">21</span>, <span class="st">"HEU-hi"</span> <span class="op">=</span> <span class="fl">21</span><span class="op">)</span></span>
<span><span class="va">fill_ptype</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"HU"</span> <span class="op">=</span> <span class="st">"white"</span>, <span class="st">"HEU-lo"</span> <span class="op">=</span> <span class="st">"darkgray"</span>, <span class="st">"HEU-hi"</span> <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">SinglePlot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Utility_Behemoth.html">Utility_Behemoth</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">AllMarkers</span>, var<span class="op">=</span><span class="st">"CD62L"</span>,</span>
<span>  myfactor<span class="op">=</span><span class="st">"ptype"</span>, normality<span class="op">=</span><span class="st">"dagostino"</span>, correction<span class="op">=</span><span class="st">"none"</span>,</span>
<span>  shape_palette<span class="op">=</span><span class="va">shape_ptype</span>, fill_palette<span class="op">=</span><span class="va">fill_ptype</span>,</span>
<span>  XAxisLevels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"HU"</span>, <span class="st">"HEU-lo"</span>, <span class="st">"HEU-hi"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">SinglePlot</span></span></code></pre></div>
<p>In combination with <em><a href="https://CRAN.R-project.org/package=purrr" class="external-link">purrr</a></em> we can
rapidly iterate over all the markers (skipping the initial metadata
colums) and generate all the plots. These can then be passed to
<code>Luciernaga</code> <code><a href="https://davidrach.github.io/Luciernaga/reference/Utility_Patchwork.html" class="external-link">Utility_Patchwork()</a></code> to rearrange
into patchwork objects with our desired layout, and passed to a .pdf
file.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># colnames(AllMarkers)</span></span>
<span><span class="va">TheLength</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">AllMarkers</span><span class="op">)</span></span>
<span></span>
<span><span class="va">AllPlots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">AllMarkers</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">9</span><span class="op">:</span><span class="va">TheLength</span><span class="op">)</span><span class="op">]</span>, <span class="op">~</span> <span class="fu"><a href="../reference/Utility_Behemoth.html">Utility_Behemoth</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">AllMarkers</span>, var<span class="op">=</span><span class="va">.x</span>,</span>
<span>  myfactor<span class="op">=</span><span class="st">"ptype"</span>, normality<span class="op">=</span><span class="st">"dagostino"</span>, correction<span class="op">=</span><span class="st">"none"</span>,</span>
<span>  shape_palette<span class="op">=</span><span class="va">shape_ptype</span>, fill_palette<span class="op">=</span><span class="va">fill_ptype</span>, corral.width<span class="op">=</span><span class="fl">0.7</span>,</span>
<span>  XAxisLevels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"HU"</span>, <span class="st">"HEU-lo"</span>, <span class="st">"HEU-hi"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>These in turn can be passed to <code>Luciernaga</code>
`Utility_Patchwork() function to arrange desired layout and output to a
.pdf file for late reference.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://davidrach.github.io/Luciernaga/" class="external-link">Luciernaga</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">StorageLocation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"C:"</span>, <span class="st">"Users"</span>, <span class="st">"JohnDoe"</span>, <span class="st">"Desktop"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">TheAssembledPlot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://davidrach.github.io/Luciernaga/reference/Utility_Patchwork.html" class="external-link">Utility_Patchwork</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">AllPlots</span>, filename<span class="op">=</span><span class="st">"NKT_Markers"</span>,</span>
<span> outfolder<span class="op">=</span><span class="cn">NULL</span>, thecolumns<span class="op">=</span><span class="fl">2</span>, therows<span class="op">=</span><span class="fl">3</span>, width<span class="op">=</span><span class="fl">7</span>, height<span class="op">=</span><span class="fl">9</span>,</span>
<span> returntype<span class="op">=</span><span class="st">"patchwork"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TheAssembledPlot</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="utility_heatmap">Utility_Heatmap<a class="anchor" aria-label="anchor" href="#utility_heatmap"></a>
</h2>
<p>The original visualization for the Coereba clusters, in a Bananaquit
color-scheme. Next time someone insist there are just 5 clusters in
their FlowSOM, point them here.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ThePlot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Utility_Heatmap.html">Utility_Heatmap</a></span><span class="op">(</span>binary<span class="op">=</span><span class="va">binaryData</span>, panel<span class="op">=</span><span class="va">panelPath</span>,</span>
<span>  export<span class="op">=</span><span class="cn">FALSE</span>, outpath<span class="op">=</span><span class="cn">NULL</span>, filename<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ThePlot</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="diffcyt-port">Diffcyt port<a class="anchor" aria-label="anchor" href="#diffcyt-port"></a>
</h2>
<p>Wrote the function to send the outputs to diffcyt for the
edgeR/limma/GLMM modeling of the results (vs the above t-test approach).
It works, but does it mean it’s less p-hacky? TBD. Also, given diffcyt’s
current maintenance status (looking at you Luke), may not be best
approach vs a new implementation.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by David Rach.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
